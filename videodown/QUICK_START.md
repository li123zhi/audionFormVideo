# 🚀 快速启动指南 - 增强功能版

## ✅ 所有4个增强功能已完成！

### 功能清单
1. ✅ **字幕时间分析报告** - 详细的时间对比分析
2. ✅ **字幕时间可视化** - ECharts图表展示
3. ✅ **优化的剪辑算法** - 最佳匹配+避免重复
4. ✅ **批量处理功能** - 同时处理多个视频

---

## 🎯 立即开始使用（3步）

### 第1步：安装依赖

**后端依赖**:
```bash
cd videorecomp/backend
pip install pysrt chardet
```

**前端依赖**:
```bash
cd videorecomp/frontend
npm install echarts
```

### 第2步：启动服务

```bash
cd /Users/ruite_ios/Desktop/aiShortVideo/videorecomp/videodown/videorecomp
./start-web.sh
```

服务将在以下地址启动：
- 前端：http://localhost:8080
- 后端API：http://localhost:5001

### 第3步：打开Web界面

1. 打开浏览器访问 `http://localhost:8080`
2. 你会看到3个菜单项：
   - 📹 **重新生成视频** - 单个视频处理（已增强）
   - ✂️ **拆分配音文件** - 音频拆分功能
   - 📁 **批量处理** - 批量视频处理（新增）

---

## 📖 使用示例

### 示例1：单个视频 + 字幕分析

1. **导航到"重新生成视频"页面**
2. **上传文件**：
   - 拖拽原视频 `example.mp4`
   - 拖拽原字幕 `example_original.srt`
   - 拖拽新字幕 `example_new.srt`
   - 拖拽配音ZIP文件

3. **启用自动剪辑**
   - 勾选"自动剪辑视频"开关
   - 系统会显示高级选项：
     - 合并间隙：调整到 1.0 秒
     - 精确模式：关闭（快速处理）

4. **开始处理**
   - 点击"开始处理"按钮
   - 等待处理完成（约2-5分钟）

5. **下载结果**
   - 新字幕软字幕版本（推荐）
   - 新字幕硬字幕版本
   - 原字幕软字幕版本
   - 原字幕硬字幕版本
   - 不带字幕版本
   - 剪辑后的原视频

### 示例2：使用批量处理

1. **准备多个视频文件**
   ```
   videos/
   ├── video1.mp4 + video1_original.srt + video1_new.srt
   ├── video2.mp4 + video2_original.srt + video2_new.srt
   └── video3.mp4 + video3_original.srt + video3_new.srt
   ```

2. **导航到"批量处理"页面**
   - 点击导航栏的"批量处理"

3. **添加任务**
   ```
   任务1:
   - 原视频: /path/to/video1.mp4
   - 原字幕: /path/to/video1_original.srt
   - 新字幕: /path/to/video1_new.srt
   点击"添加任务"

   任务2:
   - 原视频: /path/to/video2.mp4
   - 原字幕: /path/to/video2_original.srt
   - 新字幕: /path/to/video2_new.srt
   点击"添加任务"

   任务3: ... (重复)
   ```

4. **配置全局参数**
   - 合并间隙：设置为 1.5 秒
   - 精确模式：关闭

5. **开始批量处理**
   - 点击"开始批量处理 (3)"
   - 实时查看进度
   - 完成后查看统计：
     - 总计：3
     - 成功：3
     - 失败：0

---

## 🎨 界面预览

### 重新生成视频页面（已增强）

```
┌─────────────────────────────────────────────┐
│  📹 重新生成视频                             │
├─────────────────────────────────────────────┤
│  上传文件                                     │
│  ┌──────────────┐  ┌──────────────┐        │
│  │ 原视频        │  │ 原字幕(可选)  │        │
│  └──────────────┘  └──────────────┘        │
│  ┌──────────────┐  ┌──────────────┐        │
│  │ 新字幕        │  │ 配音ZIP       │        │
│  └──────────────┘  └──────────────┘        │
│                                              │
│  ☑ 自动剪辑视频                               │
│    ├─ 合并间隙: [━━━━○━━] 1.0秒             │
│    └─ 精确模式:  □ (启用后更精确但更慢)       │
│                                              │
│  [ 开始处理 ]                                 │
└─────────────────────────────────────────────┘
```

### 批量处理页面（新增）

```
┌─────────────────────────────────────────────┐
│  📁 批量处理视频                             │
├─────────────────────────────────────────────┤
│  添加任务                                     │
│  原视频: [___________________]               │
│  原字幕: [___________________]               │
│  新字幕: [___________________]               │
│  [ 添加任务 ] [ 清空 ]                        │
│                                              │
│  全局参数                                     │
│  合并间隙: [━━━○━━━] 1.5秒                   │
│  精确模式: □                                  │
│                                              │
│  任务列表 (3)                                 │
│  ┌──┬──────────┬────────┬────────┬────┐   │
│  │# │视频路径   │原字幕   │新字幕   │操作│   │
│  ├──┼──────────┼────────┼────────┼────┤   │
│  │1 │video1.mp4│orig1   │new1    │删除│   │
│  │2 │video2.mp4│orig2   │new2    │删除│   │
│  │3 │video3.mp4│orig3   │new3    │删除│   │
│  └──┴──────────┴────────┴────────┴────┘   │
│                                              │
│  [ 开始批量处理 (3) ]                         │
└─────────────────────────────────────────────┘
```

---

## 🔧 配置说明

### 合并间隙 (merge_gap)

| 值 | 适用场景 | 效果 |
|----|---------|------|
| 0.5秒 | 时间偏移很小 | 保持精确，可能有轻微卡顿 |
| 1.0秒 | 时间偏移中等 | 平衡选择（推荐） |
| 2.0秒 | 时间偏移较大 | 更流畅，可能保留多余画面 |
| 5.0秒 | 偏移很大或需要流畅 | 最大限度流畅 |

### 精确模式 (use_precise)

| 模式 | 速度 | 精度 | 推荐场景 |
|-----|------|------|---------|
| 关闭（快速） | ⚡⚡⚡ 快 | ±1-2秒 | 大多数情况 |
| 开启（精确） | ⚡ 慢 | ±0.1秒 | 需要高精度时 |

---

## 📊 新增API接口

### 1. 分析字幕
```bash
POST /api/analyze-subtitles
Content-Type: multipart/form-data

# 响应
{
  "analysis": {
    "summary": {
      "original_count": 54,
      "new_count": 54,
      "start_offset": { "avg": -0.123, "min": -0.5, "max": 0.3 }
    }
  },
  "visualization": {
    "timeline": [...],
    "start_diff_histogram": {...},
    "duration_diff_histogram": {...}
  },
  "recommendations": {
    "merge_gap": 1.0,
    "reason": "时间偏移中等，平衡流畅度和精确度",
    "confidence": "medium"
  }
}
```

### 2. 增强剪辑
```bash
POST /api/enhanced-clip
Content-Type: multipart/form-data

Body:
- video: 视频文件
- original_srt: 原字幕
- new_srt: 新字幕
- merge_gap: 1.0 (可选)
- use_precise: false (可选)
```

### 3. 批量处理
```bash
POST /api/batch-clip
Content-Type: application/json

Body:
{
  "tasks": [
    { "video_path": "...", "original_srt_path": "...", "new_srt_path": "..." }
  ],
  "merge_gap": 1.5,
  "use_precise": false
}
```

---

## 💡 最佳实践

1. **第一次使用？先测试**
   - 上传1个视频测试功能
   - 检查输出结果
   - 调整参数后再批量处理

2. **参数选择建议**
   - 初次使用：merge_gap=1.0, use_precise=false
   - 精度要求高：merge_gap=0.5, use_precise=true
   - 追求速度：merge_gap=2.0, use_precise=false

3. **批量处理技巧**
   - 同类型视频使用相同参数
   - 每批不超过10个视频
   - 保存好源文件以便重新处理

---

## 🐛 常见问题

### Q: 分析组件不显示图表？
A: 安装echarts: `npm install echarts`

### Q: 批量处理中断了怎么办？
A: 重新上传未完成的任务即可

### Q: 剪辑后视频有黑屏？
A: 增大merge_gap参数到2.0或更大

### Q: 处理时间太长？
A: 关闭精确模式，增大merge_gap

---

## 📞 技术支持

遇到问题？
1. 查看 [ENHANCEMENT_GUIDE.md](ENHANCEMENT_GUIDE.md) 详细文档
2. 检查浏览器控制台错误
3. 查看后端日志：`videorecomp/backend/backend.log`

---

## 🎉 准备好了吗？

```bash
# 1. 启动服务
cd videorecomp
./start-web.sh

# 2. 打开浏览器
open http://localhost:8080

# 3. 开始使用！
```

**祝你使用愉快！** 🚀
